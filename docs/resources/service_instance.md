---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "railway_service_instance Resource - terraform-provider-railway"
subcategory: ""
description: |-
  Railway service instance - environment-scoped service configuration.
  This resource allows you to configure a service instance for a specific environment,
  including setting the source image independently per environment.
  Unlike railway_service which sets the source image at the project level (affecting all environments),
  this resource lets you deploy different images to staging vs production environments.
  Example Usage
  ```hcl
  Create the service (project-scoped)
  resource "railwayservice" "api" {
    name       = "api"
    projectid = railway_project.main.id
  }
  Configure staging instance with staging image
  resource "railwayserviceinstance" "apistaging" {
    serviceid     = railwayservice.api.id
    environmentid = railwayenvironment.staging.id
    sourceimage   = "ghcr.io/myorg/api:staging"
  registrycredentialsusername = var.ghcrusername
    registrycredentialspassword = var.ghcrtoken
  # Enable serverless mode for staging (sleeps when inactive)
    sleep_application = true
  # Health check configuration
    healthcheckpath    = "/health"
    healthchecktimeout = 30
  }
  Configure production instance with production image
  resource "railwayserviceinstance" "apiproduction" {
    serviceid     = railwayservice.api.id
    environmentid = railwayenvironment.production.id
    sourceimage   = "ghcr.io/myorg/api:v1.2.3"
  registrycredentialsusername = var.ghcrusername
    registrycredentialspassword = var.ghcrtoken
  # Production should always restart on failure
    restartpolicytype       = "ONFAILURE"
    restartpolicymaxretries = 3
  # Custom start command
    start_command = "npm run start:prod"
  # Run database migrations before deployment
    predeploycommand = ["npm run db:migrate"]
  # Health check configuration
    healthcheckpath    = "/health"
    healthchecktimeout = 60
  }
  ```
---

# railway_service_instance (Resource)

Railway service instance - environment-scoped service configuration.

This resource allows you to configure a service instance for a specific environment,
including setting the source image independently per environment.

Unlike `railway_service` which sets the source image at the project level (affecting all environments),
this resource lets you deploy different images to staging vs production environments.

## Example Usage

```hcl
# Create the service (project-scoped)
resource "railway_service" "api" {
  name       = "api"
  project_id = railway_project.main.id
}

# Configure staging instance with staging image
resource "railway_service_instance" "api_staging" {
  service_id     = railway_service.api.id
  environment_id = railway_environment.staging.id
  source_image   = "ghcr.io/myorg/api:staging"

  registry_credentials_username = var.ghcr_username
  registry_credentials_password = var.ghcr_token

  # Enable serverless mode for staging (sleeps when inactive)
  sleep_application = true

  # Health check configuration
  healthcheck_path    = "/health"
  healthcheck_timeout = 30
}

# Configure production instance with production image
resource "railway_service_instance" "api_production" {
  service_id     = railway_service.api.id
  environment_id = railway_environment.production.id
  source_image   = "ghcr.io/myorg/api:v1.2.3"

  registry_credentials_username = var.ghcr_username
  registry_credentials_password = var.ghcr_token

  # Production should always restart on failure
  restart_policy_type       = "ON_FAILURE"
  restart_policy_max_retries = 3

  # Custom start command
  start_command = "npm run start:prod"

  # Run database migrations before deployment
  pre_deploy_command = ["npm run db:migrate"]

  # Health check configuration
  healthcheck_path    = "/health"
  healthcheck_timeout = 60
}
```



<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `environment_id` (String) Identifier of the environment.
- `service_id` (String) Identifier of the service.

### Optional

- `build_command` (String) Custom build command to run during the build phase.
- `builder` (String) Build system to use. Valid values: `NIXPACKS`, `HEROKU`, `PAKETO`, `RAILPACK`.
- `healthcheck_path` (String) HTTP path for health checks (e.g., `/health`). Railway will poll this endpoint to determine service health.
- `healthcheck_timeout` (Number) Timeout in seconds for health check requests.
- `pre_deploy_command` (List of String) Commands to run before deployment (e.g., database migrations).
- `redeploy` (Boolean) Whether to trigger a redeployment after updating the service instance. **Default** `true`.
- `registry_credentials_password` (String, Sensitive) Password for private Docker registry authentication.
- `registry_credentials_username` (String) Username for private Docker registry authentication.
- `restart_policy_max_retries` (Number) Maximum number of restart retries when using `ON_FAILURE` policy.
- `restart_policy_type` (String) Restart policy type. Valid values: `ALWAYS`, `NEVER`, `ON_FAILURE`.
- `sleep_application` (Boolean) Enable serverless mode. When enabled, the application sleeps after 10 minutes of inactivity and wakes on incoming requests.
- `source_image` (String) Docker image to deploy for this service instance. Conflicts with `source_repo`.
- `source_repo` (String) GitHub repository to deploy for this service instance. Conflicts with `source_image`.
- `start_command` (String) Custom start command to run the application.

### Read-Only

- `id` (String) Composite identifier of the service instance (service_id:environment_id).


